<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../d2l-icons/d2l-icon.html">
<link rel="import" href="../../d2l-typography/d2l-typography-shared-styles.html">
<link rel="import" href="../../d2l-colors/d2l-colors.html">
<link rel="import" href="../../d2l-icons/tier3-icons.html">
<link rel="import" href="../src/behaviors/date-behavior.html">
<link rel="import" href="../src/behaviors/localize-behavior.html">

<dom-module id="d2l-all-assessments-list-item">
	<template>
		<style>
			:host {
				display: block;
				margin: 10px auto;
				background-color: var(--d2l-color-white);
				border: 1px var(--d2l-color-titanius) solid;
				border-radius: 6px;
				padding: 20px 0;
			}

			.assessment-title {
				@apply --d2l-heading-3;
				margin: 0;
			}

			.row {
				display: flex;
				align-items: center;
			}

			.course-name {
				@apply --d2l-body-standard-text;
				font-size: 0.7rem;
				display: flex;
				flex-direction: row;
				align-items: center;
			}

			.activity-icon, .spacer {
				flex: 0 0 100px;
			}

			.instructions {
				@apply --d2l-body-compact-text;
				font-size: 0.8rem;
				font-weight: 300;
				margin-top: 12px;
				max-height: 2.4rem;
				overflow: hidden;
				padding-right: 100px;
			}

			.info-container {
				display: flex;
				justify-content: space-between;
				width: 100%;
				padding-right: 100px;
			}

			.item-header {
				justify-content: space-between;
			}

			.critical-info {
				align-self: flex-start;
				color: var(--d2l-color-olivine);;
				border: 1px solid var(--d2l-color-olivine);;
				border-radius: 6px;
				padding: 5px 20px;
				margin-top: -5px;
				text-transform: uppercase;
			}
			.critical-info:empty {
				display: none;
			}

			@media (max-width: 767px) {
				:host {
					border-radius: 0px;
					border-left: 0px;
					border-right: 0px;
				}

				.instructions-row {
					display: none;
				}

				.info-container {
					padding-right: 30px;
				}
			}

		</style>
			<div class="row">
				<d2l-icon class="activity-icon" icon="d2l-tier3:assignments"></d2l-icon>
				<div class="info-container">
					<div class="item-header">
						<h3 class="assessment-title">[[assessmentItem.name]]</h3>
						<div class="course-name">[[assessmentItem.courseName]]</div>
					</div>
					<div class="critical-info">[[_getCriticalInfo(assessmentItem)]]</div>
				</div>
			</div>
			<div class="row instructions-row">
				<div class="spacer"></div>
				<div class="instructions">[[assessmentItem.instructions]]</div>
			</div>
	</template>

	<script>
	'use strict';

	Polymer({

		is: 'd2l-all-assessments-list-item',

		properties: {
			assessmentItem: Object
		},

		behaviors: [
			window.D2L.UpcomingAssessments.DateBehavior,
			window.D2L.UpcomingAssessments.LocalizeBehavior
		],

		_isCompleted: function(item) {
			return item.isCompleted;
		},

		_getDateString: function(dueDateUTC) {
			var dueDateString;


			if (calendarDateDiff === 0) {
				dueDateString = this.localize('today');
			} else if (calendarDateDiff === 1) {
				dueDateString = this.localize('tomorrow');
			} else {
				dueDateString = new Intl.DateTimeFormat(this.locale, { month: 'long', day: 'numeric' }).format(new Date(dueDateUTC));
			}

			return this.localize('dueDateShort', 'dueDate', dueDateString);
		},

		_getCriticalInfo: function(assessmentItem) {
			if (assessmentItem.isComplete) {
				return this.localize('complete');
			}

			var dueDateString;
			var calendarDateDiff = this.getDateDiffInCalendarDays(assessmentItem.dueDate);

			if (calendarDateDiff === 0) {
				dueDateString = this.localize('today');
			} else if (calendarDateDiff === 1) {
				dueDateString = this.localize('tomorrow');
			}

			if (dueDateString) {
				return this.localize('dueDateShort', 'dueDate', dueDateString);
			}
		}

	});
	</script>
</dom-module>
